# Dino ERP: Склад (dino_erp_stock)

Модуль **dino_erp_stock** — расширение для Odoo, предназначенное для управления складской номенклатурой, компонентами, спецификациями (BOM) и параметрами продукции.

## Описание

Модуль автоматизирует процессы ведения складской номенклатуры, категорий и параметров компонентов, а также спецификаций сборки (BOM). Подходит для производственных и торговых предприятий, где требуется детализированный учет компонентов и их структуры.

## Основные возможности
- Ведение иерархии компонент и категорий
- Управление спецификациями (BOM) для продукции
- Хранение и настройка параметров компонентов
- Расширение стандартных моделей Odoo для работы с товарами и их атрибутами
- Локализация интерфейса (русский, украинский)
- Гибкая настройка прав доступа

## Структура модуля

```
dino_erp_stock/
├── __init__.py
├── __manifest__.py
├── SPECIFICATION.md
├── data/
│   └── ir_sequence_data.xml
├── i18n/
│   ├── ru.po
│   └── uk.po
├── models/
│   ├── __init__.py
│   ├── dino_bom.py
│   ├── dino_component_category.py
│   ├── dino_component.py
│   ├── dino_nomenclature.py
│   └── dino_parameter.py
├── security/
│   └── ir.model.access.csv
├── views/
│   ├── dino_component_category_views.xml
│   ├── dino_component_views.xml
│   ├── dino_nomenclature_views.xml
├── www/
│   ├── product_attribute_views.xml
│   ├── product_component_attribute.py
│   ├── product_component_bom_views.xml
│   ├── product_component_bom.py
│   ├── product_component_views.xml
│   ├── product_component.py
│   ├── product.template.md
│   ├── ru.po
│   └── uk.po
```

## Краткое описание моделей

- **dino.component.category** — категории компонентов (иерархия, фильтрация)
- **dino.component** — компоненты (товары, детали, полуфабрикаты)
- **dino.nomenclature** — номенклатура склада (основной справочник)
- **dino.bom** — спецификации сборки (BOM)
- **dino.parameter** — параметры компонентов (размеры, характеристики)

## Установка

1. Скопируйте модуль в директорию `addons` вашего Odoo:
   ```bash
   cp -r dino_erp_stock /path/to/odoo/addons/
   ```
2. Перезагрузите сервер Odoo:
   ```bash
   sudo systemctl restart odoo
   # или
   ./odoo-bin --reload-modules
   ```
3. Обновите список модулей и установите модуль через интерфейс Odoo или командой:
   ```bash
   odoo-bin -d database_name -i dino_erp_stock
   ```

## Использование

1. Перейдите в меню **Склад > Компоненты** для работы с компонентами
2. Используйте категории для группировки и фильтрации
3. Создавайте и редактируйте спецификации (BOM) для продукции
4. Настраивайте параметры компонентов для детального учета
5. Используйте переводы для работы на русском и украинском языках

## Права доступа
- **base.group_user** — чтение, создание, редактирование (без удаления)
- **stock.group_stock_manager** — полный доступ (включая удаление)

## Локализация
- Русский (ru.po)
- Украинский (uk.po)

## Зависимости
- `base` — базовый модуль Odoo
- `product` — товары
- `stock` — склад

## Авторство
Разработано командой **Revent24**

## Лицензия
LGPL-3

---
# Дополнение: Автоматический пересчет себестоимости

## Логика автоматического пересчета

Модуль реализует автоматический пересчет себестоимости продукции и компонентов при изменении спецификации (BOM) или связанных документов:

- При изменении, создании или удалении строки спецификации (`dino.bom.line`) происходит автоматический поиск всех верхнеуровневых сборок, где участвует изменённый компонент, и для каждой из них рекурсивно запускается пересчет себестоимости.
- Пересчет также происходит при изменении строки номенклатуры в связанных документах (например, закупочных или производственных), если они интегрированы с моделью `dino.nomenclature`.
- Логика реализована в моделях `dino.nomenclature` и `dino.bom.line` через методы `action_update_cost_recursive` и автоматические триггеры в `create`, `write`, `unlink`.
- Пересчет происходит top-down: от верхнего уровня к компонентам, что гарантирует актуальность стоимости для всех сборок.

## Пример работы

1. Изменили количество или состав компонентов в BOM — пересчет стоимости всех связанных сборок происходит автоматически.
2. Изменили цену или параметры компонента — пересчет стоимости всех сборок, где он используется, происходит автоматически.
3. Добавили или изменили строку спецификации в связанном документе — стоимость обновляется во всех затронутых сборках.

---
